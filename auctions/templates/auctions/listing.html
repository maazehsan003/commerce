{% extends "auctions/layout.html" %}

{% block body %}
<div class="container">
    {% if not listing.is_active %}
  <div class="alert alert-secondary" role="alert">
    <strong>This auction is closed.</strong>
  </div>

  {% if is_winner %}
    <div class="alert alert-success" role="alert">
      ðŸŽ‰ <strong>Congratulations!</strong> You won this auction.
    </div>
  {% endif %}
{% endif %}


</div>
<div class="container">
    <div class="row">
        <div class="col-md-6">
        <img src="{{ listing.image_url }}" alt="Listing Image" width="300px">
        </div>
    
    <div class="col-md-6">
        <h2>{{ listing.title }}</h2>
        <p>{{ listing.description }}</p><br>
        <h5>Details:</h5>
        <ul class="info">
            <li>
                {% if listing.is_active %}
                Status: Active
                {% endif %}
                {% if not listing.is_active %}
                Status: Closed
                {% endif %}
            </li>
            <li>
                Category: {{ listing.category}}
            </li>
            <li>
                Starting Bid: {{ listing.starting_bid }}
            </li>
            <li>
                Current Bid: {{ listing.highest_bid }}
            </li>
            <li>
                Owner: {{ listing.owner }}
            </li>
            {% if not is_owner %}
            <li>
                <form method="post" action="{% url 'toggle_watchlist' listing.id %}">
                      {% csrf_token %}
                   <button type="submit" class="btn btn-primary" style="margin-top: 5px;">
                      {% if user in listing.watchers.all %}
                      Remove from Watchlist
                      {% else %}
                     Add to Watchlist
                     {% endif %}
                   </button>
                </form>
            </li>
            {% endif %}
        </ul>
    </div>
</div>
</div>
{% if listing.is_active %}
{% if not is_owner %}
<div class="container">
    <h4>Place Bid</h4>

<div class="formBid">
   {% if user.is_authenticated and listing.is_active %}
  <form method="post">
        {% csrf_token %}
        <input type="number" name="bid" step="0.01">
        <button type="submit" name="bid_button" class="btn btn-primary">Place Bid</button>
   </form>
{% endif %}
</div>
</div>
{% endif %}
{% endif %}
{% if error_message %}
  <div class="alert alert-danger" role="alert">
    {{ error_message }}
  </div>
{% endif %}

<div class="container">
<div class="formInput">
    {% if is_owner and listing.is_active %}
   <form method="post">
       {% csrf_token %}
       <button type="submit" name="close" class="btn btn-primary">Close Auction</button>
   </form>
{% endif %}
</div>
</div>
<div class="container">
<h3>Comments</h3>
  <ul>
  {% for comment in comments %}
    <li>{{ comment.author }}: {{ comment.content }}</li>
  {% endfor %}
  </ul>
</div>
<div class="container">
    <h4>Add Comment</h4>

<div class="formComment">
    {% if user.is_authenticated %}
  <form method="post">
      {% csrf_token %}
      <div class="formInput">
     <textarea name="comment"></textarea>
     <button type="submit" class="btn btn-primary">Add Comment</button>
      </div>
  </form>
{% endif %}
</div>    
</div> 



{% endblock %}